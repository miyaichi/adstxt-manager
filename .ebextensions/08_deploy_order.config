files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_set_tmp_vars.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # ディスク空き容量がなくなるのを防ぐ
      echo "Cleaning temporary files to ensure enough disk space..."
      rm -rf /tmp/*
      rm -rf /var/tmp/*
      
      # デプロイ開始情報をログに記録
      echo "Starting deployment at $(date)" >> /var/log/eb-deploy.log
      
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_finalize.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # デプロイ完了時のクリーンアップと最適化
      echo "Finalizing deployment..."
      
      # npm キャッシュのクリーンアップ
      npm cache clean --force
      
      # 未使用の依存関係を削除
      cd /var/app/current && npm prune --production
      
      # 一時ファイルの削除
      find /var/app/current -name "*.log" -delete
      find /var/app/current -name ".DS_Store" -delete
      
      # デプロイ完了情報をログに記録
      echo "Deployment completed at $(date)" >> /var/log/eb-deploy.log
      
      # システム情報をログに出力
      echo "System status after deployment:" >> /var/log/eb-deploy.log
      free -h >> /var/log/eb-deploy.log
      df -h >> /var/log/eb-deploy.log