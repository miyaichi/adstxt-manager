container_commands:
  01_install_backend_dependencies:
    command: |
      cd /var/app/staging/backend
      npm install
    
  02_build_backend:
    command: |
      cd /var/app/staging/backend
      echo "Building backend TypeScript code..."
      ./node_modules/.bin/tsc
      
      # Check if build was successful
      if [ -f /var/app/staging/backend/dist/server.js ]; then
        echo "Backend build successful!"
      else
        echo "Backend build failed! dist/server.js not found."
        exit 1
      fi

  03_create_procfile:
    command: |
      echo "web: cd /var/app/current/backend && npm start" > /var/app/staging/Procfile
      cat /var/app/staging/Procfile