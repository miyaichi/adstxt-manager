container_commands:
  01_fix_db_connection:
    command: |
      # Create .env file with correct database connection settings
      mkdir -p /var/app/staging/backend
      echo "DB_PROVIDER=postgres" > /var/app/staging/backend/.env
      echo "PGHOST=awseb-e-vb3bggm9qp-stack-awsebrdsdatabase-eblwi87ocxx0.cwtgd8gpsmhu.ap-northeast-1.rds.amazonaws.com" >> /var/app/staging/backend/.env
      echo "PGPORT=5432" >> /var/app/staging/backend/.env
      echo "PGDATABASE=adstxt_manager" >> /var/app/staging/backend/.env
      echo "PGUSER=dbadmin" >> /var/app/staging/backend/.env
      echo "PGPASSWORD=H4kKfRTKGBwkCAyM" >> /var/app/staging/backend/.env
      echo "PG_MAX_POOL_SIZE=10" >> /var/app/staging/backend/.env
      echo "NODE_ENV=production" >> /var/app/staging/backend/.env
      echo "PORT=8080" >> /var/app/staging/backend/.env
      cat /var/app/staging/backend/.env