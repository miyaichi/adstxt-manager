files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_fix_db_connection.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # Override environment variables in a place that's loaded by the app
      cat > /var/app/current/backend/.env << EOL
DB_PROVIDER=postgres
PGHOST=awseb-e-vb3bggm9qp-stack-awsebrdsdatabase-eblwi87ocxx0.cwtgd8gpsmhu.ap-northeast-1.rds.amazonaws.com
PGPORT=5432
PGDATABASE=adstxt_manager
PGUSER=dbadmin
PGPASSWORD=H4kKfRTKGBwkCAyM
PG_MAX_POOL_SIZE=10
NODE_ENV=production
PORT=8080
EOL
      
      # Restart the application to pick up the new environment
      systemctl restart web.service
      
      exit 0