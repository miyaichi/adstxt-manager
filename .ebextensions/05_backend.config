container_commands:
  # フロントエンドビルド後にバックエンドビルドを行う - 順序制御
  02_backend_build:
    command: |
      echo "Building backend..."
      export NODE_OPTIONS="--max-old-space-size=2048"
      cd backend && npm ci --production=false && npm run build
    leader_only: true
  
  # データベースディレクトリの準備
  03_prepare_database:
    command: |
      echo "Preparing database directory..."
      mkdir -p backend/db
      chmod 777 backend/db
      touch backend/db/database.sqlite
      chmod 666 backend/db/database.sqlite
    leader_only: true
  
  # 本番環境用の依存関係に切り替え
  04_production_dependencies:
    command: |
      echo "Installing production dependencies..."
      cd backend && rm -rf node_modules && npm ci --production=true
    leader_only: true