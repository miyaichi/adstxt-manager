option_settings:
  # Enhanced health monitoring
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    
  # Configure load balancer health check
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /
    Port: 8080
    Protocol: HTTP
    HealthCheckInterval: 15
    HealthCheckTimeout: 5
    HealthyThresholdCount: 3
    UnhealthyThresholdCount: 5
    
files:
  "/var/app/current/dummy-server.js":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      const http = require('http');
      
      // Create a simple HTTP server
      const server = http.createServer((req, res) => {
        res.writeHead(200, { 'Content-Type': 'application/json' });
        res.end(JSON.stringify({
          status: 'ok',
          message: 'The application is starting up'
        }));
      });
      
      // Listen on port 8080
      server.listen(8080, () => {
        console.log('Emergency server listening on port 8080');
      });
      
container_commands:
  01_start_emergency_server:
    command: "node /var/app/current/dummy-server.js > /var/log/emergency-server.log 2>&1 &"
    ignoreErrors: true