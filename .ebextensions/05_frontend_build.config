files:
  "/tmp/build_frontend.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      cd /var/app/current
      
      # Install frontend dependencies
      echo "Installing frontend dependencies..."
      cd frontend
      npm install --production=false
      
      # Build frontend
      echo "Building frontend..."
      npm run build
      
      # Move build files to backend public directory
      echo "Moving frontend build to backend/public..."
      mkdir -p ../backend/public
      cp -R build/* ../backend/public/
      
      echo "Frontend build completed"

container_commands:
  01_build_frontend:
    command: "/tmp/build_frontend.sh"
    leader_only: true