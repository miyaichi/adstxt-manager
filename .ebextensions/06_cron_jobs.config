files:
  "/etc/cron.d/fetch_sellers_json":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Run fetch-sellers-json.js hourly
      0 * * * * root /usr/bin/flock -n /tmp/fetch-sellers-json.lock /usr/local/bin/run_fetch_sellers_json.sh > /dev/null 2>&1

  "/usr/local/bin/run_fetch_sellers_json.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # Log start time
      echo "Starting fetch-sellers-json.js at $(date)" >> /var/log/fetch-sellers-json.log
      
      # Change to the application directory
      cd /var/app/current/backend
      
      # Run the script
      NODE_ENV=production node fetch-sellers-json.js >> /var/log/fetch-sellers-json.log 2>&1
      
      # Log completion
      echo "Completed fetch-sellers-json.js at $(date)" >> /var/log/fetch-sellers-json.log
      echo "-------------------------------------------" >> /var/log/fetch-sellers-json.log

commands:
  01_create_log_file:
    command: "touch /var/log/fetch-sellers-json.log && chmod 644 /var/log/fetch-sellers-json.log"
  02_restart_crond:
    command: "service crond restart || service cron restart"