container_commands:
  01_setup_db_env:
    command: |
      # Get RDS connection info from EBS environment
      RDS_HOSTNAME=$(printenv PGHOST || echo "localhost")
      RDS_PORT=$(printenv PGPORT || echo "5432")
      
      # Create the .env file with manually specified values
      mkdir -p /var/app/staging/backend
      
      echo "DB_PROVIDER=postgres" > /var/app/staging/backend/.env
      echo "PGHOST=$RDS_HOSTNAME" >> /var/app/staging/backend/.env  
      echo "PGPORT=5432" >> /var/app/staging/backend/.env
      echo "PGDATABASE=adstxt_manager" >> /var/app/staging/backend/.env
      echo "PGUSER=dbadmin" >> /var/app/staging/backend/.env
      echo "PGPASSWORD=H4kKfRTKGBwkCAyM" >> /var/app/staging/backend/.env
      echo "PG_MAX_POOL_SIZE=10" >> /var/app/staging/backend/.env
      echo "NODE_ENV=production" >> /var/app/staging/backend/.env
      echo "PORT=8080" >> /var/app/staging/backend/.env
      
      echo "Created database environment file:"
      cat /var/app/staging/backend/.env
  
  02_check_db_env:
    command: |
      echo "Checking database environment variables:"
      env | grep -i pg || true